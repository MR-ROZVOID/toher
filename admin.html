<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø±Ø³Ø§Ø¦Ù„ Ø­Ø¨ Ø³Ø±Ù‘ÙŠØ©</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at top, #ffb6c1, #2b002b);
            color: #fff;
        }

        .heart-bg {
            position: fixed;
            inset: 0;
            pointer-events: none;
            opacity: 0.35;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255,255,255,0.4) 0, transparent 50%),
                radial-gradient(circle at 80% 10%, rgba(255,192,203,0.4) 0, transparent 55%),
                radial-gradient(circle at 90% 80%, rgba(255,105,180,0.4) 0, transparent 50%);
            z-index: -1;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(20, 0, 25, 0.9);
            border-radius: 24px;
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.7);
            padding: 24px;
            border: 1px solid rgba(255, 192, 203, 0.5);
            backdrop-filter: blur(10px);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 20px;
        }

        .title-block h1 {
            font-size: 1.7rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .title-block p {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 4px;
        }

        .link-to-view {
            font-size: 0.8rem;
            opacity: 0.85;
        }

        .link-to-view a {
            color: #ffb6e1;
            text-decoration: none;
            border-bottom: 1px dashed rgba(255, 182, 193, 0.7);
        }

        .link-to-view a:hover {
            opacity: 1;
        }

        h2.section-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        h2.section-title span.icon {
            font-size: 1.3rem;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-size: 0.85rem;
            opacity: 0.85;
            margin-bottom: 2px;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            border-radius: 14px;
            border: 1px solid rgba(255, 192, 203, 0.5);
            background: rgba(255, 255, 255, 0.04);
            color: #fff;
            padding: 9px 11px;
            font-size: 0.9rem;
            outline: none;
            transition: 0.2s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: #ff9ac6;
            box-shadow: 0 0 0 1px rgba(255, 154, 198, 0.6);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            max-height: 200px;
            line-height: 1.5;
        }

        .inline {
            display: flex;
            gap: 10px;
        }

        .inline > div {
            flex: 1;
        }

        @media (max-width: 700px) {
            .inline {
                flex-direction: column;
            }
        }

        .hint {
            font-size: 0.77rem;
            opacity: 0.7;
            margin-top: 2px;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 9px 16px;
            font-size: 0.95rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff7eb3, #ff758c);
            color: #fff;
            box-shadow: 0 10px 25px rgba(255, 105, 180, 0.55);
        }

        .btn-primary:hover {
            transform: translateY(-1px) scale(1.01);
            box-shadow: 0 14px 30px rgba(255, 105, 180, 0.75);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid rgba(255, 192, 203, 0.6);
            color: #ffbdd6;
        }

        .btn-outline:hover {
            background: rgba(255, 192, 203, 0.1);
        }

        .link-box {
            margin-top: 12px;
            padding: 10px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px dashed rgba(255, 192, 203, 0.7);
            font-size: 0.85rem;
        }

        .link-box code {
            word-break: break-all;
            font-family: monospace;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            border-radius: 999px;
            padding: 3px 9px;
            font-size: 0.75rem;
            background: rgba(255, 255, 255, 0.08);
        }

        .fade {
            opacity: 0;
            transform: translateY(6px);
            transition: 0.25s;
        }

        .fade.show {
            opacity: 1;
            transform: translateY(0);
        }

        .footer {
            margin-top: 18px;
            font-size: 0.75rem;
            text-align: center;
            opacity: 0.7;
        }

        .footer span.heart {
            animation: pulse 1.4s infinite;
            display: inline-block;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.9;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
<div class="heart-bg"></div>

<div class="container">
    <header class="header">
        <div class="title-block">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ©·</h1>
            <p>Ø£Ù†Ø´Ø¦ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø¨ Ø³Ø±Ù‘ÙŠØ© ÙˆØ´Ø§Ø±Ùƒ Ø±Ø§Ø¨Ø·Ù‹Ø§ Ø®Ø§ØµÙ‹Ø§ Ù…Ø¹ Ù…Ù† ØªØ­Ø¨.</p>
        </div>
        <div class="link-to-view">
            ØµÙØ­Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„:
            <a href="view.html" target="_blank">view.html</a>
        </div>
    </header>

    <main>
        <section>
            <h2 class="section-title">
                <span class="icon">ğŸ“</span> Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </h2>
            <form id="message-form">
                <div class="inline">
                    <div>
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input type="text" id="recipient" placeholder="Ù…Ø«Ø§Ù„: Ø¥Ù„Ù‰ Ù†Ø¨Ø¶ Ù‚Ù„Ø¨ÙŠ..." />
                    </div>
                    <div>
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                        <select id="category">
                            <option value="Ø­Ø¨">Ø±Ø³Ø§Ù„Ø© Ø­Ø¨ â¤ï¸</option>
                            <option value="Ø´Ø¹Ø±">Ø£Ø¨ÙŠØ§Øª Ø´Ø¹Ø±ÙŠØ© âœ¨</option>
                            <option value="Ø§Ù‚ØªØ¨Ø§Ø³">Ø§Ù‚ØªØ¨Ø§Ø³ Ø¬Ù…ÙŠÙ„ ğŸ’­</option>
                            <option value="Ø³Ø±">Ø³Ø± ØµØºÙŠØ± Ø¨ÙŠÙ†Ù†Ø§ ğŸ”</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label>Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± Ù„Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                    <input type="text" id="title" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø£Ù†Ùƒ Ø§Ù„Ø£Ø¬Ù…Ù„..." />
                    <p class="hint">ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªÙ„Ù… ÙƒØªØ±ÙˆÙŠØ³Ø© Ø¨Ø³ÙŠØ·Ø©.</p>
                </div>

                <div>
                    <label>Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                    <textarea id="message" placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„ Ù…Ø§ ÙÙŠ Ù‚Ù„Ø¨Ùƒ Ù‡Ù†Ø§..."></textarea>
                </div>

                <div class="inline">
                    <div>
                        <label>ÙƒÙˆØ¯ Ø³Ø±ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <input type="text" id="code" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹" />
                        <p class="hint">ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù…Ù‹Ø§ Ø£Ùˆ Ø­Ø±ÙˆÙÙ‹Ø§ (Ù…Ø«Ø§Ù„: LOVE123).</p>
                    </div>
                    <div>
                        <label>Ù…Ø¯Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <select id="expire">
                            <option value="never">Ø¨Ø¯ÙˆÙ† Ø§Ù†ØªÙ‡Ø§Ø¡</option>
                            <option value="once">ØªÙÙØªØ­ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</option>
                            <option value="oneDay">ØµØ§Ù„Ø­Ø© Ù„ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</option>
                        </select>
                    </div>
                </div>

                <div class="inline">
                    <button type="submit" class="btn btn-primary">
                        Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© â¤ï¸
                    </button>
                    <button type="button" class="btn btn-outline" id="generate-code-btn">
                        ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ğŸ”‘
                    </button>
                </div>

                <div class="link-box fade" id="link-box">
                    <div class="pill">
                        ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
                    </div>
                    <p class="hint">Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ù‚ØµÙˆØ¯.</p>
                    <code id="generated-link"></code>
                    <div style="margin-top:8px;">
                        <button type="button" class="btn btn-outline" id="copy-link-btn">
                            Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ“‹
                        </button>
                    </div>
                </div>
            </form>
        </section>
    </main>

    <div class="footer">
        Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·ØŒ Ø§Ù„Ø­Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ <span class="heart">â¤</span>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ù„ÙŠ ğŸ‘‡
    const firebaseConfig = {
        apiKey: "AIzaSyCht2TZJ3szoaKJIGMa6b0rcUa5QXWMPI8",
        authDomain: "future-surge-477108-p6.firebaseapp.com",
        projectId: "future-surge-477108-p6",
        storageBucket: "future-surge-477108-p6.firebasestorage.app",
        messagingSenderId: "582261977489",
        appId: "1:582261977489:web:2ecc24902223756513aa30"
    };

    // ØªØ´ØºÙŠÙ„ Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ===== Ù†ÙØ³ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© =====
    const form = document.getElementById("message-form");
    const recipientInput = document.getElementById("recipient");
    const categorySelect = document.getElementById("category");
    const titleInput = document.getElementById("title");
    const messageInput = document.getElementById("message");
    const codeInput = document.getElementById("code");
    const expireSelect = document.getElementById("expire");
    const linkBox = document.getElementById("link-box");
    const generatedLink = document.getElementById("generated-link");
    const generateCodeBtn = document.getElementById("generate-code-btn");
    const copyLinkBtn = document.getElementById("copy-link-btn");

    function generateRandomCode() {
        const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
        let code = "";
        for (let i = 0; i < 6; i++) {
            code += chars[Math.floor(Math.random() * chars.length)];
        }
        return code;
    }

    // Ù†Ø¨Ù†ÙŠ Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ ØµÙØ­Ø© view.html Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ (ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ GitHub Pages Ø£ÙŠØ¶Ø§Ù‹)
    function buildLink(code) {
        const url = new URL(window.location.href);
        url.pathname = url.pathname.replace("admin.html", "view.html");
        url.search = "";
        url.searchParams.set("code", code);
        return url.toString();
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const recipient = recipientInput.value.trim();
        const category = categorySelect.value;
        const title = titleInput.value.trim();
        const text = messageInput.value.trim();
        const expire = expireSelect.value;

        let code = codeInput.value.trim().toUpperCase();

        if (!text) {
            alert("Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹ ğŸ©·");
            return;
        }

        if (!code) {
            code = generateRandomCode();
            codeInput.value = code;
        }

        try {
            // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ø³Ù…Ù‡Ø§ "messages" ÙÙŠ Firestore
            await setDoc(doc(db, "messages", code), {
                recipient,
                category,
                title,
                text,
                expire,
                createdAt: Date.now(),   // Ù†Ø­ÙØ¸ ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ±Ù‚Ù…
                opened: false,
                viewCount: 0
            });

            const link = buildLink(code);
            generatedLink.textContent = link;
            linkBox.classList.add("show");

            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ­ÙØ¸Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ğŸ©·\nÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ø³ØªÙ„Ù….");
        } catch (err) {
            console.error(err);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
        }
    });

    generateCodeBtn.addEventListener("click", () => {
        const newCode = generateRandomCode();
        codeInput.value = newCode;
    });

    copyLinkBtn.addEventListener("click", async () => {
        const link = generatedLink.textContent.trim();
        if (!link) return;

        try {
            await navigator.clipboard.writeText(link);
            copyLinkBtn.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…";
            setTimeout(() => {
                copyLinkBtn.textContent = "Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ğŸ“‹";
            }, 1500);
        } catch (e) {
            alert("Ù„Ù… Ø£Ø³ØªØ·Ø¹ Ø§Ù„Ù†Ø³Ø® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø±Ø¨Ø¹.");
        }
    });
</script>

</body>
</html>
